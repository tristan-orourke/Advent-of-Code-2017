//Require Vector.js
var PacketRoutingAPI = {};
const ORIGIN = new Vector([0,0]);
const UP = new Vector([0,-1]);
const DOWN = new Vector([0,1]);
const LEFT = new Vector([-1,0]);
const RIGHT = new Vector([1,0]);
const DIRECTIONS = [DOWN,LEFT,UP,RIGHT];

const VALID_CHARS = /[-|+A-Za-z]/;
const LETTERS = /[A-Za-z]/;

class Packet{
    constructor(position, direction) {
        this.position = position;
        this.direction = direction;
    }
    
    chooseDirection(map) {
        //Starting with our prev direction, try each direction going clockwise, and select the first one that puts us in a valid position;
        var testDirections = []
        //first check the direction we're already going
        testDirections.push(this.direction);
        //if that doesn't work, check all directions that don't move us backward
        for (var i=0; i<DIRECTIONS.length; i++) {
            var dir = DIRECTIONS[i];
            if (dir === this.direction || (this.direction.add(dir).equals(ORIGIN))) {
                continue; //its current direciton, or backwards
            }
            testDirections.push(dir);
        }
        for (var i=0; i<testDirections.length; i++) {
            var dir = testDirections[i];
            var testPosition = this.position.add(dir);
            if (positionIsValid(map, testPosition)) {
                this.direction = dir;
                    break;
            }
        }
    }
    
    step(map) {
        if (!positionIsOnMap(map, this.position)) {
            //We've left the map, return false
            return false;
        }
        var char = mapAt(map, this.position);
        if (char == ' ') {
            //We've alread left the path, return false
            return false;
        } else if (char == '+') {
            //Its possible we may need to change direction
            this.chooseDirection(map);
        } 
        //We've already picked a direction (or are keeping prev direction)
        var destination = this.position.add(this.direction);
        if (positionIsValid(map, destination)) {
            this.position = destination;
            return mapAt(map, destination);
        } else {
            //We've reached the end of a path
            return false;
        }
    }
}

function positionIsValid(map, position) {
    if (positionIsOnMap(map, position)) {
        var destChar = mapAt(map, position);
        return destChar.match(VALID_CHARS);
    } else {
        return false;
    }
}

function positionIsOnMap(map, vector) {
    var x = vector[0];
    var y = vector[1];
    var width = map[0].length;
    var height = map.length;
    return x >= 0 && x < width && y >= 0 && y < height;
}

function mapAt(map, vector) {
    return map[vector[1]][vector[0]];
}

PacketRoutingAPI.spellThePacketsPath = function(mapString) {
    const map = mapString.split('\n').map(x=>x.split(''));
    var startingPos = new Vector([map[0].indexOf('|'), 0]);
    var packet = new Packet(startingPos, DOWN);
    var path = [];
    while (packet.step(map)) {
        var char = mapAt(map, packet.position);
        if (char.match(LETTERS)) {
            path.push(char);
        }
    }
    return path.join('');    
};

PacketRoutingAPI.countThePacketsSteps = function(mapString) {
    const map = mapString.split('\n').map(x=>x.split(''));
    var startingPos = new Vector([map[0].indexOf('|'), 0]);
    var packet = new Packet(startingPos, DOWN);
    var count = 0;
    while (packet.step(map)) {
        count += 1;
    }
    return count + 1;    
};



var testInput = '     |          \n     |  +--+    \n     A  |  C    \n F---|----E|--+ \n     |  |  |  D \n     +B-+  +--+ ';
console.log(PacketRoutingAPI.spellThePacketsPath(testInput));

var realInput = ' |                                                                                                                                                                                                       \n |               +-------------------------------------------------------------+     +-------------------------------------------------+ +---+ +---------------------------------------------+   +-----+ \n |               |                                                             |     |                                                 | |   | |                                             |   |     | \n |               +---------------------------------------------------------------------------------------------------------------------|---------------------------------------------------+ |   |     | \n |                                                                             |     |                                                 | |   | |                                           | |   |     | \n +-----------------------------------------------------------------------------|-----------------------------------------------------------------------------------+                       | |   |     | \n                                                                               |     |                                                 | |   | |                   |                       | |   |     | \n                         +-----------------------------------------------------|-----|---------------------------------------------------|-----+   +---------------|---------------------+ | |   |     | \n                         |                                                     |     |                                                 | |   |     |               |                     | | |   |     | \n     +-------------------------------------------------------------------------------|-------------------------------------------------|-|---------|---------------------------------------------|---+ | \n     |                   |                                                     |     |                                                 | |   |     |               |                     | | |   |   | | \n     |                   |               +---+                         +---+ +-------|-------------------+                             | |   |     |               | +-------------+     | | |   |   | | \n     |                   |               |   |                         |   | | |     |                   |                             | |   |     |               | |             |     | | |   |   | | \n     |                   |               |   +-----------------------------|-|---------------------------|-----------------------------|-|---|-----------------------|-------------|-------|-|---|---+ | \n     |                   |               |                             |   | | |     |                   |                             | |   |     |               | |             |     | | |   |     | \n +-------------+         +---------------------------------------------|-----|-|---------------------------------------------------+ +---+   |     | +-------------|---------------|-----+ | |   |     | \n |   |         |                         |                             |   | | |     |                   |                         | | |     |     | |             | |             |       | |   |     | \n |   |         |                         |           +---------------------+ | |     |         +---------|-------------------------+ | |     |     | |             | |             |       | |   |     | \n |   |         |                         |           |                 |     | |     |         |         |                           | |     |     | |             | |             |       | |   |     | \n |   |         +-------------------------|-----------------------------|-----|-|---------------|-------------------------------+   +-|-|-+   |     | |             | |             |       | |   |     | \n |   |                                   |           |                 |     | |     |         |         |                     |   | | | |   |     | |             | |             |       | |   |     | \n |   |                                 +-|-----------|-----------------|-----|---------------------------------------+         |   | | | |   |     | |             | |             |       | |   |     | \n |   |                                 | |           |                 |     | |     |         |         |           |         |   | | | |   |     | |             | |             |       | |   |     | \n |   |                 +---------+     | |         +-|-----------------|-----|-------|---------|---------------------+         |   | | | |   +-------|---------------|-+     +-----+       | |   |     | \n |   |                 |         |     | |         | |                 |     | |     |         |         |                     |   | | | |         | |             | | |     |             | |   |     | \n |   |                 |         |     | |         | |     +-----------|-----|-----------------|-------+ +---------------------------|-|---------------------------|-|-|---+ |             | |   |     | \n |   |                 |         |     | |         | |     |           |     | |     |         |       |                       |   | | | |         | |             | | |   | |             | |   |     | \n |   |                 |         |     | |         | | +---|-------+   | +---|-------|---------|-------|-----------------------------|---|U------------------------|-------|---------+     | |   |     | \n |   |                 |         |     | |         | | |   |       |   | |   | |     |         |       |                       |   | | | |         | |             | | |   | |       |     | |   |     | \n |   |                 |         |     | |         +---|-----------|---|-------|-----|-----------------|-----------------------------|-|-------------|----O------------|-+ | |       |     | |   |     | \n |   |                 |         |     | |           | |   |       |   | |   | |     |         |       |                       |   | | | |         | |             | | | | | |       |     | |   |     | \n |   |             +---------+   |     | |   +---------|---|-----+ |   | |   | | +-------------|-----------------------------------|-|-|-|-----------|-----+       | | +---+ |       |     | |   |     | \n |   |             |   |     |   |     | |   |       | |   |     | |   | |   | | |   |         |       |                       |   | | | |         | |     |       | |   |   |       |     | |   |     | \n |   |             |   |     |   |     | |   |       | |   |     | |   | +-----|-|---|---------|-------|-----------------------|---------------------|-----|-----------+ |   |       |     | |   |     | \n |   |             |   |     |   |     | |   |       | |   |     | |   |     | | |   |         |       |                       |   | | | |         | |     |       | | | |   |       |     | |   |     | \n |   |             |   |     |   |     | |   |   +---|-|---|-------|-------------|---------------------|-----------------------------|---|-------+ | |     |       | | | |   |     +-|-+   | |   |     | \n |   |             |   |     |   |     | |   |   |   | |   |     | |   |     | | |   |         |       |                       |   | | | |       | | |     |       | | | |   |     | | |   | |   |     | \n |   |             |   |     |   |     | |   |   |   +-|---|-----|-|-------------|---|-----------------|-----------------------|---|-------------|---|-------------------|-----+   | | |   | |   |     | \n |   |             |   |     |   |     | |   |   |     |   |     | |   |     | | |   |         |       |                       |   | | | |       | | |     |       | | | |   | |   | | |   | |   |     | \n |   |             |   |     |   |   +---|-----+ |     |   | +---------|-------------|-----------------|-----------------+     |   | | | |       | | |     |       | | | |   +-----|-------|-|-+ |     | \n |   |             |   |     |   |   | | |   | | |     |   | |   | |   |     | | |   |         |       |                 |     |   | | | |       | | |     |       | | | |     |   | | |   | | | |     | \n |   |             |   |     |   |   | | |   | | +-----|---|-|---------------|---|-------------|-------------------------|-----|---|-|-|---------|-|---------------|-|-|-|---+ |   | | |   | | | |     | \n |   |             |   |     |   |   | | |   | |       |   | |   | |   |     | | |   |         |       |                 |     |   | | | |       | | |     |       | | | |   | |   | | |   | | | |     | \n |   |             |   |     |   |   | | |   | |       |   | | +-|-|---------|---|---|---------|-------|-----------------|-----|---|---|-+ +---+ | | | +---|---------|--R----|-|---|-|-|---|---+ |     | \n |   |             |   |     |   |   | | |   | |       |   | | | | |   |     | | |   |         |       |                 |     |   | | |   |   | | | | |   |       | | | |   | |   | | |   | |   |     | \n |   | +---------------|---------|---|-|---+ | |       +-+ | | | | +---|---+ | | |   +-----------------|-----------------|-------------|---------|-|-------------------|-|-----|---|-|-|---|---+ |     | \n |   | |           |   |     |   |   | | | | | |         | | | | |     |   | | | |             |       |                 |     |   | | |   |   | | | | |   |       | | | |   | |   | | |   | | | |     | \n |   | |           |   |     |   |   | | | | +-+         | | | | |     |   | | | |             |   +---|-----------------|-----+   | +-----|-----|-----|-----------|-|---|-----|-----------|-|-|-|---+ | \n |   | |           |   |     |   |   | | | |             | | | | |     |   | | | |             |   |   |                 |         |   |   |   | | | | |   |       | | | |   | |   | | |   | | | |   | | \n |   | +-----------|---------|---|---|-------------------------|-------|---|-|-|---------------|-------|-----------------|-----+   |   +-+ |   | | | | |   |       | | | |   | |   | | |   | | | |   | | \n |   |             |   |     |   |   | | | |             | | | | |     |   | | | |             |   |   |                 |     |   |     | |   | | | | |   |       | | | |   | |   | | |   | | | |   | | \n |   |             |   |     |   |   | | | |             | | | | |     |   | | | |             |   |   |         +-----------------|-------|---|-|-----|-----------|-|-|-----+ |   | | +---+ | | |   | | \n |   |             |   |     |   |   | | | |             | | | | |     |   | | | |             |   |   |         |       |     |   |     | |   | | | | |   |       | | | |     |   | |       | | |   | | \n |   |             |   |     |   |   | | | |             | | | | |     |   | | | |             |   |   |         |       |     |   |     | |   | | | | |   |       | | | |     |   | |       | | |   | | \n |   |             |   |     |   |   | | | |             | | | | |     |   | | | |             |   |   |         |       |     |   |     | |   | | | | |   |       | | | |     |   | |       | | |   | | \n |   |           +-|---|-----|-------|-|---+             | | | | |     |   | | +-+             |   |   |         |       |     |   |     | |   | | | | |   |       | | | |     |   | |       | | |   | | \n |   |           | |   |     |   |   | | |               | | | | |     |   | |                 |   |   |         |       |     |   |     | |   | | | | |   |       | | | |     |   | |       | | |   | | \n |   |           | |   |     |   |   | | |               | | | | |     |   | |                 |   |   |         |       |     |   |     | |   | | | | |   |       | | | |     |   | |       | | |   | | \n |   |           | |   |     |   |   | | |               | | | | |     |   | |                 |   |   |         |       |     |   |     | |   | | | | |   |       | | | |     |   | |       | | |   | | \n |   |           | |   |     |   |   | | |               | | | | |     |   | +---------------+ |   |   |         |       |     |   |     | |   | | | | |   |       | | | |     | +-----------|-+ |   | | \n |   |           | |   |     |   |   | | |               | | | | |     |   |                 | |   |   |         |       |     |   |     | |   | | | | |   |       | | | |     | | | |       |   |   | | \n | +-------------+ |   |   +-|---|---|---|---------------------|-|-----|-----------------------+   |   |         |       |     |   |     | |   | | | | |   |       | | | |     | +-|-+       |   |   | | \n | | |             |   |   | |   |   | | |               | | | | |     |   |                 |     |   |         |       |     |   |     | |   | | | | |   |       | | | |     |   |         |   |   | | \n | | |             |   |   | |   |   | | |               | | | | |     |   |                 |     |   |         |     +-|---------|-----|-|-+ +-|-|-------|---+   | | | |     |   |         |   |   | | \n | | |             |   |   | |   |   | | |               | | | | |     |   |                 |     |   |         |     | |     |   |     | | |   | | | |   |   |   | | | |     |   |         |   |   | | \n | | |             |   |   | |   +-----------------------|-|-|-|-|-----------------------------------------------|-----+ |     |   |     | | |   | | | |   |   |   | | | |     |   |         |   |   | | \n | | |             |   |   | |       | | |               | | | | |     |   |                 |     |   |         |       |     |   |     | | |   | | | |   |   |   | | | |     |   |         |   |   | | \n | | |             |   |   | |       | | |               | | | | |     |   |   +---------------+   |   |         |       |     |   |     | | |   | | | |   |   |   | | | |   +-----|---------|---+   | | \n | | |             |   |   | |       | | |               | | | | |     |   |   |             | |   |   |         |       |     |   |     | | |   | | | |   |   |   | | | |   | |   |         |       | | \n | | |             |   |   | |       | | |       +---------|-|-|-------|---|-----------------|---+ |   |         |       +-----|-------------|---|-|-|-|---|-------|-----------|-------------------+ | | \n | | |             |   |   | |       | | |       |       | | | | |     |   |   |             | | | |   |         |             |   |     | | |   | | | |   |   |   | | | |   | |   |         |     | | | \n | | |             |   | +-|-|-----------|---------------|---|-|-|---------|-----------------|---------------------------------|---|-----------+ | | | |   |   |   | | | |   | |   |         |     | | | \n | | |             |   | | | |       | | |       |       | | | | |     |   |   |             | | | |   |         |             |   |     | | | | | | | |   |   |   | | | |   | |   |         |     | | | \n | +---+           |   | | | |       | | |       |       | | | | |     |   |   |             | | | |   |         |             |   |     | | | | | | | |   |   +-+ | | | |   | |   |         |     | | | \n |   | |           |   | | | |       | | |       |       | | | | |     |   |   |             | | | |   |         |             |   |     | | | | | | | |   |     | | | | |   | |   |         |     | | | \n |   | |           |   | | | +-------|-|-|-------|-------|---|---|-----|---|---+           +---|-----------------+             |   |     | | | | | | | |   |     | | | | |   | |   |         |     | | | \n |   | |           |   | | |         | | |       |       | | | | |     |   |               | | | | |   |                       |   |     | | | | | | | |   |     | | | | |   | |   |         |     | | | \n |   | |           |   | | |         | | |       |       | | | | |     |   |               | | | | |   |                       |   |     | | | | | | | |   |     | | | | |   | |   |         |     | | | \n |   | |           |   | | |         | | |       |       | | | | |     |   |               | | | | |   |                       |   |     | | Z | | C | |   |     | | | | |   | |   |         |     | | | \n |   | |           |   | | |         | | |       | +---+ | | | | |     |   |               | | | | |   |                       |   |     | | | | | | | |   |     | | | | |   | |   |         |     | | | \n |   | |           |   | | |         | | |       | |   | | | | | |     |   |               | | | | |   |                       |   |     | | | | | | | |   |     | | | | |   | |   |         |     | | | \n |   | |           |   | | |         | | | +-----|---------|-|-|-------------------------+ | | | | |   |                       |   |     | | | | | | | +-------+ | | | | |   | |   |         |     | | | \n |   | |           |   | | |         | | | |     | |   | | | | | |     |   |             | | | | | |   |                       |   |     | | | | | | |     |   | | | | | |   | |   |         |     | | | \n |   | |           |   | | |         | | | |     | |   | | | | | |     |   |             | | | | | |   |                       |   |     | | | | +---|---+ | F +-----|---|---------|---------------|-+ | \n |   | |           |   | | |         | | | |     | |   | | | | | |     |   |             | | | | | |   |                       |   |     | | | |   | |   | | |   | | | | |   | |   |         |     |   | \n |   | |           |   | | |         | | | |     | |   | | | | | |     |   |             | | | | | |   |                       +-------+ | | | |   | |   | | |   | | | | |   | |   |         |     |   | \n |   | |           |   | | |         | | | |     | |   | | | | | |     |   |             | | | | | |   |                           |   | | | | |   | |   | | |   | | | | |   | |   |         |     |   | \n |   | |           |   | | |         | | | |     | |   | | | | | |     |   |             | +---|-|-|---|-----------+               |   +-------|---|-|-------|-+ | | | | |   | |   |         | +---|-+ | \n |   | |           |   | | |         | | | |     | |   | | | | | |     |   |             |   | | | |   |           |               |     | | | |   | |   | | | | | | | | |   | |   |         | |   | | | \n |   | |           | +---|-----------------------|-----|-|-----|-------|---------------------------|---------------|---------------------------------|---|-|-|---|-------+   | |   |         | |   | | | \n |   | |           | | | | |         | | | |     | |   | | | | | |     |   |             |   | | | |   |           |               |     | | | |   | |   | | | | | | | |     | |   |         | |   | | | \n |   | |           | | | | |         | | | |     | |   +---|-|---------------------------|---|---------------------|-----+         +-------|-|-|-----|---|-|-|-------|-+ +---|-----------+   | |   | | | \n |   | |           | | | | |         | | | |     | |     | | | | |     |   |             |   | | | |   |           |     |               | | | |   | |   | | | | | | |   |   | |   |     |   | |   | | | \n |   | |       +---|---|---|-----------+ | |     | |     | | | | |     |   |             |   | | | |   +-----------|-----|-----------------|-|-|---|-|---------|---|---+ |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |     | |     | | | | |     |   |             |   | | | |               |     |               | | | |   | |   | | | | | | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |     +---------------|---------+             |   | | | |       +-------|---------------------|---|-------------+ +-|-+ | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |       |     | | | | |     |                 |   | | | |       |       |     |               | | | |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |       |     | | | | |     |                 |   | | | |       |       |     |               | | | |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |       |     | | | | |     |                 |   | | | |       |       |     |               | | | |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |       |     | | | | |     |                 |   | | | |       |       |     |               | | | |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |       |     | | | | |     |                 |   | | | |       |       |     |               | | | |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |       |     | | | | |     |           +-+   |   +---|-------+ |       |     +-------------+ | | | |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |       |     | | | | |     |           | |   |     | | |     | |       |                   | | | | |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |       |     | | | | |     |           | |   |     | | |     | |       |                   | | | | |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | | |         |   | |       |     | | | | |     |           | |   |     | | |     | |       |                   | | | | |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | | +-|-------------|---------|---------|-|-------|-----------|-|---------|-|-|-------|-----------------------------|---+ |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | |   |         |   | |       |     | | | | |     |           | |   |     | | |     | |       |                   | | |   |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | |   |         |   | |       |     | | | | |     |           | |   |     | | |     | |       |                   | | |   |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | |   |         |   | |       |     | | | | |     |           | |   |     | | |     | |       |                   | | |   |   | |   |     |   | | | |   | |   |     |   | |   | | | \n |   | |       |   | | |   |       +-|---|-|-------|-------|-|-|-------------------|-|-+ |     | | |     | |       |                   | | |   |   | |   |     +-----|---+ +-|---------------|---+ | | | \n |   | |       |   | | |   |       | |   | |       |     | | | | |     |           | | | |     | | |     | |       |                   | | |   |   | |   |         | | |   | | |   |     |   | | | | | | \n |   | |       |   | | |   |       | |   | |       |     | | | | |     |           | | | |     | | |     | |       |                   | | |   |   | |   |         | | |   | | |   |     |   | | | | | | \n |   | |       |   | | |   |       | |   | |       |     | | | | |     |           | | | |     | | |     | |       |                   | | |   |   | |   |         | | |   | | |   |     |   | | | | | | \n | +---|-----------|-|-|-----------|-|---|-------------------|---------|--E--------|---------------|-----|-+       |       +-------+   | | |   |   | |   |         | | |   | | |   |     |   | | | | | | \n | | | |       |   | | |   |       | |   | |       |     | | | | |     |           | | | |     | | |     |         |       |       |   | | |   |   | |   |         | | |   | | |   |     |   | | | | | | \n | | | |       |   | | |   |       | |   | |       |     | | | | |     |           | | | |     | | |     |         |       |       |   | | |   |   | |   |         | | |   | | |   |     |   | | | | | | \n | | | |       |   | | |   |       | |   | |       |     | | | | |     |           | | | |     | | |     |         |       |       |   | | |   |   | |   |         | | |   | | |   |     |   | | | | | | \n | | | +-------|---|---+   |       | |   | |       |     | | | | |     |           | | | |     | | |     |         |       |       |   | | |   |   | |   |         +---------|-|---+     |   | | | | | | \n | | |         |   | |     |       | |   | |       |     | | | | |     |           | | | |     | | |     |         |       |       |   | | |   |   | |   |           | |   | | |         |   | | | | | | \n | | |         |   | | +---|-------------|-|-------|-------------|-------------------+ | |     | | |     |         |       |       |   | | |   |   | |   |           | |   | | |         |   | | | | | | \n | | |         |   | | |   |       | |   | |       |     | | | | |     |           |   | |     | | |     |         |       |       |   | | |   |   | |   |           | |   | | |         |   | | | | | | \n | | |         |   | | |   |       | |   | |       |     | | | | |     |           |   | |     | | |     |         |       |       +---+ | |   |   | |   |         +-|-+   | | |         |   | | | | | | \n | | |         |   | | |   |       | |   | |       |     | | | | |     |           |   | |     | | |     |         |       |             | |   |   | |   |         | |     | | |         |   | | | | | | \n | | |         |   | | |   +---------|---|---------------|-|-|-|-|-----|---+     +-|-----------|-|-|-----------------------|-------------------|-------------------|-|-------|---+       |   | | | | | | \n | | |         |   | | |           | |   | |       |     | | | | |     |   |     | |   | |     | | |     |         |       |             | |   |   | |   |         | |     | | | |       |   | | | | | | \n | | |         |   | | |           +-|-------------|-------|---|-------|---------------|-|-----------+   |         |       |             | |   |   | |   |         | |     | | | |       |   | | | | | | \n | | |         |   | | |             |   | |       |     | | | | |     |   |     | |   | |     | | | |   |         |       |             | |   |   | |   |         | |     | | | |       |   | | | | | | \n | | |     +-------|-|-|-------------------|-------|-------|---|-----------|-------------+     | +-|-|---|-----------------|-------------------|---------|-------------------|---|-----------|---|-----+ \n | | |     |   |   | | |             |   | |       |     | | | | |     |   |     | |   |       |   | |   |         |       |             | |   |   | |   |         | |     | | | |       |   | | | | |   \n | | |     |   |   | | | +-------------+ | |       | +---------------------|-----|-|-----------|---|-|-------------|-------|-----------+ | |   |   | |   |         | |     | | | |       | +-----|-+ |   \n | | |     |   |   | | | |           | | | |       | |   | | | | |     |   |     | |   |       |   | |   |         |       |           | | |   |   | |   |         | |     | | | |       | | | | |   |   \n | | |     |   |   | | | |   +-------------|---------+   | | | | | +---|---------|-----|-------|---|-|---------------------|-----------+ | |   |   | |   |         | |     | | | |       | | | | |   |   \n | | |     |   |   | | | |   |       | | | |       |     | | | | | |   |   |     | |   |       |   | |   |         |       |             | |   |   | |   |         | |     | | | |       | | | | |   |   \n | | |     |   |   | | +-----|---------|-|-|-------------|---|-|-|-|-------------+ |   |       |   | |   |         |       |             | |   |   | |   |         | |     | | | |       | | | | | +---+ \n | | |     |   |   | |   |   |       | | | |       |     | | | | | |   |   |       |   |       |   | |   |         |       |             | |   |   | |   |         | |     | | | |       | | | | | | | | \n | | |     |   |   | | +-------------|-|-----------------|---|---|-|---|---|-------|---|-----------+ | +-|---------|--------------M------|---------------------+ +-+ |     | | | |       | | | | | | | | \n | | |     |   |   | | | |   |       | | | |       |     | | | | | |   |   |       |   |       |     | | |         |       |             | |   |   | |   |     | |   |     | | | |       | | | | | | | | \n | | |     |   |   | | | |   |       | | | |       |     | | | | | |   |   |       |   |       |   +---|---+       |       |             | |   | +-|-----------|-|---|-----|-+ | |   +---|---|---|-|-|-+ \n | | |     |   |   | | | |   |       | | | |       |     | | | | | |   |   |       |   |       |   | | | | |       |       |             | |   | | | |   |     | |   |     |   | |   |   | | | | | | |   \n | | |     |   |   | | | |   |       | | | |       |     | | | | | |   |   |       |   |       |   | | | | |       |       |             | |   | | | | +-|-----|-----------|---|-----|---|-|-|---|-|-|-+ \n | | |     |   |   | | | |   |       | | | |       |     | | | | | |   |   |       |   |       |   | | | | |       |       |             | |   | | | | | |     | |   |     |   | |   |   | | | | | | | | \n | | |     |   | +-----|-|---|---+   | | | |       |     | | | | | |   |   |       |   |       |   | | | | |       |       |             | |   | | | | | |     | |   |     |   | |   |   | | | | | | | | \n | | |     |   | | | | | |   |   |   | | | |       |     | | | | | |   |   |       |   |       |   | | | | |       |       |             | |   | | | | | |     | |   |     |   | |   |   | | | | | | | | \n | | |     |   | | | | | +---|-------|-|-+ |       |     | | | | | |   |   |       |   |       |   | | | | |       |       |             | |   | | | | | |     | |   |     |   | |   |   | | | | | | | | \n | | |     |   | | | | |     |   |   | |   |       |     | | | | | |   |   |       |   |       |   | | | | |       |       |             | |   | | | | | |     | |   |     |   | |   |   | | | | | | | | \n | | |     |   | | | | |     |   +---|-|---|-------|-------|-------+   +-----------|---|-------------|-|-|-|-------|-------+             | | +---|---|---|-----|-----------------+   |   | | | | | | | | \n | | |     |   | | | | |     |       | |   |       |     | | | | |         |       |   |       |   | | | | |       |                     | | | | | | | | |     | |   |     |   |     |   | | | | | | | | \n | | |     |   | | | | +---------------------------+     | | | | |         |       |   |       |   | | | | |       |       +-------------+ +-+ | | | | | |     | |   |     |   |     |   | | | | +-+ | | \n | | |     |   | | | |       |       | |   |             | | | | |         |       |   |       |   | | | | |       |       |                   | | | | | |     | |   |     |   |     |   | | | |     | | \n | | +-----|-+ | | | |       |       | |   | +-----------|-------|---------|---+   |   |       |   | | | | |       |       |           +---+ +-------|-|-+     | |   |     |   |     |   | | | |     | | \n | |       | | | | | |       |       | |   | |           | | | | |         |   |   |   |       |   | | | | |       |       |           |   | | | | | | |       | |   |     |   |     |   | | | |     | | \n | |       | | | | | |       |       | |   | |           | | | | |         |   |   |   |       |   | | | | |       |       |           |   | | | | | +-|---------|---|---------------------|-------+ | | \n | |       | | | | | |       |       | |   | |           | | | | |         |   |   |   |       |   | | | | |       |       |           |   | | | | |   |       | |   |     |   |     |   | | | |   | | | \n | |       | | | | | |       |       | |   | |           | | | | |         |   +-------|-------------|-------------|-----------------------|-----|-|-----------|-|-+ |     |   |     |   | | | |   | | | \n | |       | | | | | |       |       | |   | |           | | | | |         |       |   |       |   | | | | |       |       |           |   | | | | |   |       | | | |     |   |     |   | | | |   | | | \n | |       | | | | | |       |       | |   | |           | | | | |         |       |   |       |   | | | | |       |       +-+         |   | | | | |   |       | | | |     |   |     |   | | | |   | | | \n | |       | | | | | |       |       | |   | |           | | | | |         |       |   |       |   | | | | |       |         |         |   | | | | |   |       | | | |     |   |     |   | | | |   | | | \n | |       | | | | | |       |       | |   | |           | | | | |         |       |   |       |   | | | | |       |         |         | +-|-|-|-|-------------|-|-|-+     |   |     |   | | | |   | | | \n | |       | | | | | |       |       | |   | |           | | | | |         |       |   |       |   | | | | |       |         |         | | | | | | |   |       | | |       |   |     |   | | | |   | | | \n | |       | | | | | |       |       | |   | |           | | | | |         |       |   +-------|-----|-----|-----------------|---------|---|-+ | | |   |       | | |       |   |     |   +-+ | |   | | | \n | |       | | | | | |       |       | |   | |           | | | | |         |       |           |   | | | | |       |         |         | | |   | | |   |       | | |       |   |     |       | |   | | | \n | | +---------|-----------+ |       | |   | |         +-----|-----------------+   +-----------|---------|-+       |       +-|-------+ | | +---+ | |   | +-+   | +-|---------------+ |       | |   | | | \n | | |     | | | | | |     | |       | |   | |         | | | | | |         |   |               |   | | | |         |       | |       | | |       | |   | | |   |   |       |   |   | |       | |   | | | \n | | |     | | | | | |     | |       | |   | |         | | | | | |         |   |               |   | | | |         |       | |       +-|-|-------+ |   | | |   |   |       |   |   | |       | |   | | | \n | | |     | | | | | |     | |       | |   | |         | | | | | |         |   |               |   | | | |         |       | |         | |         |   | | |   |   |       |   |   | |       | |   | | | \n | | |     | | | | | +-------|-------------|-|---------|---|---|-|-----------------------------|-------|-|-----------------------------|-|-------------|-|-|-------|-----------------|-------|-|---|-+ | \n | | |     | | | | |       | |       | |   | |         | | | | | |         |   |               |   | | | |         |       | |         | |         |   | | |   |   |       |   |   | |       | |   |   | \n | | |     | | | | |       | |       | |   | |         | +-|---|-|---------|-----------------------------------------------|-|-----------|---------|---|-|-------+ |       |   |   | |       | | +---+ | \n | | |     | | | | |       | |       | |   | |         |   | | | |         |   |               |   | | | |         |       | |         | |         |   | | |   | | |       |   |   | |       | | | | | | \n | | |     | | | | |       | |       | |   | |         |   | | | |         |   |               |   | | | |         |       | |         | |         |   | | |   | | |       |   |   | |       | | | | | | \n | | |     | | | | |       | |       | |   | |         |   | | | |         |   |               |   | | | |         |       | |         | |         |   | | |   | | |       |   |   | |       | | | | | | \n | | +-------|-----+       | |       | |   | |         |   | | | |         +---|---------------|-------|-|---------|-------------------------------|---+ | |   | | |       |   |   | |       | | | | | | \n | |       | | | |         | |       | |   | |         |   | | | |             |               |   | | | |         |       | |         | |         |     | |   | | |       |   |   | |       | | | | | | \n +-|---------|-----------------------------|-|-------------|---|---------------|-------------------|---|-|-----------------------------+ |         |   +-|-----|---|-------|-----+ | |       | | | | | | \n   |       | | | |         | |       | |   | |         |   | | | |             |               |   | | | |         |       | |           |         |   | | |   | | |       |   | | | |       | | | | | | \n   |       | | | |         | |       | +-------------------|---|-|-----------------------------|---|---|-|---------|-----------------------------------+ | |   | | |       |   | | | |       | | | | | | \n   |       | | | |         | |       |     | |         |   | | | |             |               |   | | | |         |       | |           |         |     | |   | | |       |   | | | |       | | | | | | \n   |       | | | |         | |       |     | |         |   | | | |             |               |   | | | | +---------------|-|-----------+         |     | |   +---|-----------|---|-------------+ | | | \n   |       | | | |         | |       |     | |         |   | | | |             |               |   | | | | |       |       | |                     |     | |     | |       |   | | | |       | |   | | | \n   |       | | | |         +-|-------|-----|-----------+   | | | |             |               |   | | +-|-|-------|---------|---------+           +-------|-------|---------+ | | | |       | |   | | | \n   |       | | | |           |       |     | |             | | | |             |               |   | |   | |       |       | |         |                 | |     | |       | | | | | |       | |   | | | \n   |       | | | |           |   +---|-----+ |             | | | |             |     +---------+   +-|---+ +---------------|-|---------|-----------------|-+     | |       | | | | | |       | |   | | | \n   |       | | | |           |   |   |       |             | | | |             |     |               |             |       | |         |                 |       | |       | | | | | |       | |   | | | \n   |       | | | |           |   |   |       |             | | | |             |     +-----------------------------+       +-+     +-----------------------------+ |       | | | | | | +-+   +-+   | | | \n   |       | | | |           |   |   |       |             | | | |             |                     |                             |   |                 |         |       | | | | | | | |         | | | \n   |       | | | |           |   +-----------|-------------|---+ |             |                     +---------------------------------+                 |         |       | +-+ | | | | +---+ +---+ | | \n   |       | | | |           |       |       |             | |   |             |                                                   |                     |         |       |     | | | |     | |     | | \n   |       | | | |           |       |       |             | |   +-------------|---------------------------------------------------------+               | +-------+       | +---|-|-|-|-+   +-+   +-+ | \n   |       | | | |           |       |       |             | |                 |                                                   |     |               | |               | |   | | | | |         |   | \n   |       | | | |           |       |       |             | |                 +---------------------------------------------------------|---------------------------------|-+   | | +-|-+         |   | \n   |       | | | |           |       |       |             | |                                                                     |     |               | |               |     | |   |           |   | \n   |   +-------|-+           +---------------|-------------+ |                                   +---------------------------------|-----|---------------------------------------+ |   |           |   | \n   |   |   | | |                     |       |               |                                   |                                 |     |               | |               |       |   |           |   | \n   | +-+   | +-+                     |       |               | +---------------------------------|---------------------------------------+               | |               +--Q--+ +-+ |           |   | \n   | |     |                         |       |               | |                                 |                                 |                     | |                     |   | |           |   | \n   | +-----+                         |       +---------------|-+         +-----------------------+                                 +---------------------+ +---------------------+   +-|-----------+   | \n   |                                 |                       |           |                                                                                                             |               | \n   |                                 +-----------------------+           +-------------------------------------------------------------------------------------------------------------+               | \n   |                                                                                                                                                                                                   | \n   +---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ \n                                                                                                                                                                                                         ';
console.log(PacketRoutingAPI.spellThePacketsPath(realInput));
console.log(PacketRoutingAPI.countThePacketsSteps(testInput));
console.log(PacketRoutingAPI.countThePacketsSteps(realInput));